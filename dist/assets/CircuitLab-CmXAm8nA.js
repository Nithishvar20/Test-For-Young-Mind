import{r as S,j as e}from"./index-CuAHal8p.js";const G=1.8,H=10,z=1e9,P=.001;let X=200;const U=()=>++X,I=4,F=4;function le(){const[r,x]=S.useState(I),[a,n]=S.useState(F),[o,h]=S.useState("resistor"),[i,f]=S.useState(null),[y,m]=S.useState(()=>O(I,F)),[d,j]=S.useState([]),[p,M]=S.useState({voltages:{},currents:{}}),[l,C]=S.useState(null);S.useEffect(()=>{m(O(r,a))},[r,a]),S.useEffect(()=>{re(d,y,M)},[d,y]);function R(t){if(!i){f(t);return}if(i.id===t.id){f(null);return}const g=v(o,i.id,t.id);j(s=>[...s,g]),f(null)}function v(t,g,s){const c=U();switch(t){case"resistor":return{id:c,type:t,a:g,b:s,value:220,label:"R"};case"battery":return{id:c,type:t,a:g,b:s,value:9,label:"Bat"};case"led":return{id:c,type:t,a:g,b:s,label:"LED",meta:{r:z}};case"switch":return{id:c,type:t,a:g,b:s,label:"SW",closed:!0};case"wire":return{id:c,type:t,a:g,b:s,label:"W"};default:return{id:c,type:t,a:g,b:s,value:0,label:t}}}function E(t){j(g=>g.filter(s=>s.id!==t))}function L(t,g){j(s=>s.map(c=>c.id===t?{...c,value:g}:c))}function k(t){j(g=>g.map(s=>s.id===t?{...s,closed:!s.closed}:s))}function A(){j([]),M({voltages:{},currents:{}}),f(null)}return e.jsxs("div",{style:{position:"absolute",top:50,left:0,right:0,bottom:0,padding:18,boxSizing:"border-box",background:"linear-gradient(180deg,#0b1220,#1b0920)",color:"#fff",overflow:"hidden"},children:[e.jsxs("header",{style:{marginBottom:12},children:[e.jsx("h2",{style:{margin:0,fontSize:34,fontWeight:900},children:"Circuit Lab — Interactive Breadboard"}),e.jsx("div",{style:{marginTop:6,color:"rgba(255,255,255,0.78)"},children:"Select a component, then click two nodes on the board to place it. LEDs glow when forward current flows."})]}),e.jsxs("div",{style:{display:"flex",gap:12,height:"calc(100% - 120px)"},children:[e.jsxs("aside",{style:Y,children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"Palette"}),e.jsx(V,{label:"Resistor",type:"resistor",selected:o,onSelect:h}),e.jsx(V,{label:"Battery (V)",type:"battery",selected:o,onSelect:h}),e.jsx(V,{label:"LED (Diode)",type:"led",selected:o,onSelect:h}),e.jsx(V,{label:"Switch",type:"switch",selected:o,onSelect:h}),e.jsx(V,{label:"Wire",type:"wire",selected:o,onSelect:h}),e.jsx("div",{style:{marginTop:12},children:e.jsx("button",{onClick:A,style:q,children:"Clear Circuit"})})]}),e.jsx("div",{style:{flex:1,position:"relative"},children:e.jsx("div",{style:{height:"100%",borderRadius:12,padding:18,background:"linear-gradient(180deg,#071022,#081025)",boxShadow:"0 12px 30px rgba(0,0,0,0.5)"},children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${r*120} ${a*100}`,style:{display:"block"},children:[e.jsx("defs",{children:e.jsx("marker",{id:"wire-arrow",markerWidth:"8",markerHeight:"8",refX:"6",refY:"3",orient:"auto",children:e.jsx("path",{d:"M0,0 L6,3 L0,6 z",fill:"#ffd166"})})}),y.map(t=>e.jsx("circle",{cx:t.x,cy:t.y,r:i&&i.id===t.id?7:l&&l.id===t.id?5:3,fill:i&&i.id===t.id?"#a78bfa":"#94a3b8",opacity:.95,onMouseEnter:()=>C(t),onMouseLeave:()=>C(null),onClick:()=>R(t),style:{cursor:"pointer"}},t.id)),d.filter(t=>t.type==="wire").map(t=>e.jsx(Q,{comp:t,nodes:y,solution:p},t.id)),d.map(t=>t.type==="resistor"?e.jsx(Z,{comp:t,nodes:y,solution:p,onEdit:L,onRemove:E},t.id):t.type==="battery"?e.jsx(ee,{comp:t,nodes:y,solution:p,onEdit:L,onRemove:E},t.id):t.type==="led"?e.jsx(te,{comp:t,nodes:y,solution:p,onRemove:E},t.id):t.type==="switch"?e.jsx(ie,{comp:t,nodes:y,solution:p,onToggle:k,onRemove:E},t.id):null)]})})}),e.jsxs("aside",{style:K,children:[e.jsx("div",{style:{fontWeight:800,marginBottom:8},children:"Inspector"}),e.jsxs("div",{style:{fontSize:13,maxHeight:260,overflow:"auto"},children:[d.length===0&&e.jsx("div",{style:{color:"rgba(255,255,255,0.6)"},children:"No components placed."}),d.map(t=>e.jsxs("div",{style:{padding:8,borderRadius:8,background:"rgba(255,255,255,0.02)",marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{fontWeight:800},children:[J(t.type)," ",e.jsxs("span",{style:{color:"rgba(255,255,255,0.65)"},children:["(",t.id,")"]})]}),e.jsx("div",{children:t.type==="switch"?e.jsx("button",{onClick:()=>k(t.id),style:T,children:t.closed?"Open":"Close"}):e.jsx("button",{onClick:()=>E(t.id),style:T,children:"Remove"})})]}),e.jsxs("div",{style:{fontSize:12,color:"rgba(255,255,255,0.7)"},children:["nodes: ",t.a,", ",t.b]}),t.type==="resistor"&&e.jsxs("div",{style:{marginTop:6},children:[e.jsx("input",{type:"range",min:1,max:1e5,value:t.value,onChange:g=>L(t.id,Number(g.target.value)),style:{width:"100%"}}),e.jsxs("div",{style:{fontSize:12,textAlign:"right"},children:[t.value," Ω"]})]}),t.type==="battery"&&e.jsxs("div",{style:{marginTop:6},children:[e.jsx("input",{type:"range",min:1,max:24,step:.1,value:t.value,onChange:g=>L(t.id,Number(g.target.value)),style:{width:"100%"}}),e.jsxs("div",{style:{fontSize:12,textAlign:"right"},children:[t.value.toFixed(1)," V"]})]})]},t.id))]}),e.jsx("hr",{style:{border:"none",height:1,background:"rgba(255,255,255,0.04)",margin:"10px 0"}}),e.jsx("div",{style:{fontWeight:800},children:"Simulation"}),e.jsxs("div",{style:{marginTop:8,fontSize:13},children:[e.jsx("div",{style:{fontWeight:700},children:"Node voltages (V)"}),e.jsxs("div",{style:{maxHeight:140,overflow:"auto",marginTop:6},children:[Object.keys(p.voltages).length===0&&e.jsx("div",{style:{color:"rgba(255,255,255,0.6)"},children:"—"}),Object.entries(p.voltages).map(([t,g])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0"},children:[e.jsxs("div",{children:["Node ",t]}),e.jsxs("div",{children:[Number(g).toFixed(3)," V"]})]},t))]}),e.jsx("div",{style:{fontWeight:700,marginTop:8},children:"Component currents (A)"}),e.jsxs("div",{style:{maxHeight:140,overflow:"auto",marginTop:6},children:[Object.keys(p.currents).length===0&&e.jsx("div",{style:{color:"rgba(255,255,255,0.6)"},children:"—"}),Object.entries(p.currents).map(([t,g])=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"4px 0"},children:[e.jsxs("div",{children:["Comp ",t]}),e.jsxs("div",{children:[Number(g).toFixed(4)," A"]})]},t))]})]})]})]})]})}const Y={width:220,background:"rgba(17,24,39,0.95)",borderRadius:12,padding:12,boxSizing:"border-box"},K={width:320,background:"rgba(17,24,39,0.95)",borderRadius:12,padding:12,boxSizing:"border-box"},T={background:"rgba(255,255,255,0.06)",border:"none",color:"#fff",padding:"6px 8px",borderRadius:8,cursor:"pointer"},q={...T,background:"linear-gradient(90deg,#ef4444,#f97316)"};function V({label:r,type:x,selected:a,onSelect:n}){const o=a===x;return e.jsxs("div",{onClick:()=>n(x),style:{display:"flex",alignItems:"center",gap:10,padding:10,borderRadius:8,marginBottom:8,cursor:"pointer",background:o?"linear-gradient(90deg,#7c3aed,#a78bfa)":"transparent"},children:[e.jsx("div",{style:{width:42,height:42,borderRadius:8,background:o?"#fff":"rgba(255,255,255,0.06)",display:"flex",alignItems:"center",justifyContent:"center",color:o?"#7c3aed":"#fff",fontWeight:800},children:r[0]}),e.jsx("div",{style:{fontWeight:800},children:r})]})}function J(r){switch(r){case"resistor":return"Resistor";case"battery":return"Battery";case"led":return"LED";case"switch":return"Switch";case"wire":return"Wire";default:return r}}function W(r,x){return r.find(a=>a.id===x)||{x:0,y:0}}function B(r,x){const a=x.x-r.x,n=x.y-r.y;return Math.atan2(n,a)*180/Math.PI}function Q({comp:r,nodes:x,solution:a}){var f;const n=W(x,r.a),o=W(x,r.b),h=Math.abs(((f=a.currents)==null?void 0:f[r.id])||0),i=se(h);return e.jsx("line",{x1:n.x,y1:n.y,x2:o.x,y2:o.y,stroke:i,strokeWidth:6,strokeLinecap:"round"})}function Z({comp:r,nodes:x,solution:a}){var d;const n=W(x,r.a),o=W(x,r.b),h={x:(n.x+o.x)/2,y:(n.y+o.y)/2},i=B(n,o),f=Math.abs(((d=a.currents)==null?void 0:d[r.id])||0),y=Math.min(1,f/.06),m=y>.05?`rgba(253,224,71,${.25+y*.6})`:"#f59e0b";return e.jsxs("g",{transform:`translate(${h.x},${h.y}) rotate(${i})`,children:[e.jsx("line",{x1:-48,y1:0,x2:-28,y2:0,stroke:"#9aa6b2",strokeWidth:4}),e.jsx("line",{x1:28,y1:0,x2:48,y2:0,stroke:"#9aa6b2",strokeWidth:4}),e.jsx("rect",{x:-28,y:-14,width:56,height:28,rx:10,fill:m,stroke:"#111827",strokeWidth:2}),e.jsx("polyline",{points:"-22,0 -14,-8 -6,8 2,-8 10,8 18,-8 26,0",fill:"none",stroke:"#111827",strokeWidth:3,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("rect",{x:-6,y:-14,width:6,height:28,fill:"#111827"}),e.jsx("rect",{x:4,y:-14,width:6,height:28,fill:"#4ade80"}),e.jsx("rect",{x:14,y:-14,width:6,height:28,fill:"#ef4444"}),e.jsxs("text",{x:0,y:36,fill:"#fff",fontSize:12,textAnchor:"middle",children:[r.value," Ω"]})]})}function ee({comp:r,nodes:x}){const a=W(x,r.a),n=W(x,r.b),o={x:(a.x+n.x)/2,y:(a.y+n.y)/2},h=B(a,n);return e.jsxs("g",{transform:`translate(${o.x},${o.y}) rotate(${h})`,children:[e.jsx("line",{x1:-48,y1:0,x2:-20,y2:0,stroke:"#9aa6b2",strokeWidth:4}),e.jsx("line",{x1:20,y1:0,x2:48,y2:0,stroke:"#9aa6b2",strokeWidth:4}),e.jsx("line",{x1:-10,y1:-22,x2:-10,y2:22,stroke:"#fff",strokeWidth:6,strokeLinecap:"round"}),e.jsx("line",{x1:10,y1:-12,x2:10,y2:12,stroke:"#fff",strokeWidth:10,strokeLinecap:"round"}),e.jsxs("text",{x:0,y:36,fill:"#fff",fontSize:12,textAnchor:"middle",children:[r.value.toFixed(1)," V"]}),e.jsx("text",{x:-10,y:-28,fill:"#22c1ff",fontSize:12,textAnchor:"middle",children:"+"}),e.jsx("text",{x:10,y:28,fill:"#ff7a7a",fontSize:12,textAnchor:"middle",children:"−"})]})}function te({comp:r,nodes:x,solution:a}){var p;const n=W(x,r.a),o=W(x,r.b),h={x:(n.x+o.x)/2,y:(n.y+o.y)/2},i=B(n,o),f=((p=a.currents)==null?void 0:p[r.id])||0,y=Math.abs(f),m=Math.min(1,y/P),d=m>.06,j="#ff6b6b";return e.jsxs("g",{transform:`translate(${h.x},${h.y}) rotate(${i})`,children:[e.jsx("line",{x1:-48,y1:0,x2:-16,y2:0,stroke:"#bbb",strokeWidth:4}),e.jsx("line",{x1:16,y1:0,x2:48,y2:0,stroke:"#bbb",strokeWidth:4}),e.jsx("line",{x1:-16,y1:0,x2:-6,y2:0,stroke:"#777",strokeWidth:3}),e.jsx("line",{x1:6,y1:0,x2:16,y2:0,stroke:"#777",strokeWidth:3}),e.jsx("ellipse",{cx:0,cy:0,rx:18,ry:22,fill:d?j:"#5b1f1f",stroke:"#111827",strokeWidth:1.5}),e.jsx("ellipse",{cx:-6,cy:-6,rx:6,ry:4,fill:"rgba(255,255,255,0.35)",opacity:d?.9:.45}),e.jsx("polygon",{points:"-6,-6 -6,6 6,0",fill:d?"#fff":"#ffd",opacity:.9}),e.jsx("line",{x1:8,y1:-8,x2:14,y2:-14,stroke:d?"#fffafa":"#ffd",strokeWidth:1.6}),e.jsx("line",{x1:8,y1:8,x2:14,y2:14,stroke:d?"#fffafa":"#ffd",strokeWidth:1.6}),d&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:0,cy:0,r:36,fill:`${j}`,opacity:.12*m,style:{filter:"blur(6px)"}}),e.jsx("circle",{cx:0,cy:0,r:56*m,fill:j,opacity:.06*m,style:{filter:"blur(12px)"}})]}),e.jsx("text",{x:0,y:40,fill:"#fff",fontSize:12,textAnchor:"middle",children:"LED"})]})}function ie({comp:r,nodes:x,onToggle:a}){const n=W(x,r.a),o=W(x,r.b),h={x:(n.x+o.x)/2,y:(n.y+o.y)/2},i=B(n,o),f=!!r.closed;return e.jsxs("g",{transform:`translate(${h.x},${h.y}) rotate(${i})`,children:[e.jsx("line",{x1:-48,y1:0,x2:-12,y2:0,stroke:"#9aa6b2",strokeWidth:4}),e.jsx("line",{x1:12,y1:0,x2:48,y2:0,stroke:"#9aa6b2",strokeWidth:4}),e.jsx("rect",{x:-18,y:-12,width:36,height:24,rx:6,fill:f?"#34d399":"#374151",stroke:"#000",strokeWidth:1}),e.jsx("circle",{cx:f?8:-8,cy:0,r:6,fill:"#fff",stroke:"#000",strokeWidth:1,style:{cursor:"pointer"},onClick:()=>a(r.id)}),e.jsx("text",{x:0,y:40,fill:"#fff",fontSize:12,textAnchor:"middle",children:"Switch"})]})}function se(r){const x=Math.min(8,r*2);return x<.3?"rgba(148,163,184,0.12)":x<1?"rgba(124,58,237,0.9)":x<3?"rgba(34,211,238,0.95)":"rgba(253,224,71,0.98)"}function re(r,x,a){if(!r||r.length===0){a({voltages:{},currents:{}});return}const n=new Set;r.forEach(l=>{n.add(l.a),n.add(l.b)});const o=Array.from(n).sort((l,C)=>l-C),h=o.length;if(h===0){a({voltages:{},currents:{}});return}const i={};o.forEach((l,C)=>i[l]=C);const f=[],y=[],m=[];r.forEach(l=>{l.type==="resistor"?f.push({id:l.id,a:i[l.a],b:i[l.b],g:1/Math.max(1e-12,l.value)}):l.type==="wire"?f.push({id:l.id,a:i[l.a],b:i[l.b],g:1/1e-6}):l.type==="battery"?y.push({id:l.id,a:i[l.a],b:i[l.b],V:l.value}):l.type==="led"?m.push({id:l.id,a:i[l.a],b:i[l.b],r_on:H,r_off:z,state:"off",r:z}):l.type==="switch"&&l.closed&&f.push({id:l.id,a:i[l.a],b:i[l.b],g:1/1e-6})});let d=m.map(l=>({...l})),j={},p={};const M=14;for(let l=0;l<M;l++){const C=y.length,R=h+C,v=Array.from({length:R},()=>Array(R).fill(0)),E=Array(R).fill(0);f.forEach(s=>{const c=s.g,u=s.a,b=s.b;u!==void 0&&(v[u][u]+=c),b!==void 0&&(v[b][b]+=c),u!==void 0&&b!==void 0&&(v[u][b]-=c,v[b][u]-=c)}),d.forEach(s=>{const c=1/Math.max(1e-12,s.r),u=s.a,b=s.b;u!==void 0&&(v[u][u]+=c),b!==void 0&&(v[b][b]+=c),u!==void 0&&b!==void 0&&(v[u][b]-=c,v[b][u]-=c)}),y.forEach((s,c)=>{const u=h+c,b=s.a,w=s.b;b!==void 0&&(v[b][u]+=1),w!==void 0&&(v[w][u]+=-1),b!==void 0&&(v[u][b]+=1),w!==void 0&&(v[u][w]+=-1),E[h+c]=s.V});const L=1e-12;for(let s=0;s<h;s++)v[s][s]+=L;const k=ne(v,E);if(!k){j={},p={};break}const A={};o.forEach((s,c)=>A[s]=k[c]);const t={};r.forEach(s=>{if(s.type==="resistor"){const c=i[s.a],u=i[s.b],b=k[c]||0,w=k[u]||0;t[s.id]=(b-w)/Math.max(1e-12,s.value)}else if(s.type==="wire"){const c=i[s.a],u=i[s.b],b=k[c]||0,w=k[u]||0;t[s.id]=(b-w)/1e-6}else if(s.type==="battery"){const c=y.findIndex(u=>u.id===s.id);t[s.id]=c>=0?k[h+c]:0}else if(s.type==="led"){const c=d.find(N=>N.id===s.id),u=i[s.a],b=i[s.b],w=k[u]||0,$=k[b]||0;t[s.id]=(w-$)/(c.r||z)}else s.type,t[s.id]=0});let g=!1;if(d=d.map(s=>{const c=s.a,u=s.b,b=k[c]||0,w=k[u]||0,$=b-w,N=Math.abs($)>=G,_=N?"on":"off",D=N?s.r_on:s.r_off;return(_!==s.state||D!==s.r)&&(g=!0),{...s,state:_,r:D}}),j=A,p=t,!g)break}a({voltages:j,currents:p})}function ne(r,x){const a=r.length,n=r.map(i=>i.slice()),o=x.slice();for(let i=0;i<a;i++){let f=i,y=Math.abs(n[i][i]);for(let d=i+1;d<a;d++)Math.abs(n[d][i])>y&&(y=Math.abs(n[d][i]),f=d);if(Math.abs(y)<1e-14)return null;f!==i&&([n[i],n[f]]=[n[f],n[i]],[o[i],o[f]]=[o[f],o[i]]);const m=n[i][i];for(let d=i;d<a;d++)n[i][d]/=m;o[i]/=m;for(let d=i+1;d<a;d++){const j=n[d][i];if(!(Math.abs(j)<1e-15)){for(let p=i;p<a;p++)n[d][p]-=j*n[i][p];o[d]-=j*o[i]}}}const h=Array(a).fill(0);for(let i=a-1;i>=0;i--){let f=o[i];for(let y=i+1;y<a;y++)f-=n[i][y]*h[y];h[i]=f/n[i][i]}return h}function O(r,x){const a=[];let h=1;for(let i=0;i<x;i++)for(let f=0;f<r;f++)a.push({id:h++,row:i,col:f,x:60+f*120,y:60+i*100});return a}export{le as default};
